/*
 * test01a.c
 * Test Program T1a - Multiple Thread Creation
 * Chris Meyer, CISC
 * This shows the creation of many threads, generated by both main
 * and by secondary threads, testing robustness of t_yield and TCB
 * queues, and showing different termination times of different threads.
 *
 */

#include <stdio.h>
#include "src/ud_thread.h"

// single thread: doesn't generate any other threads
void single_thread(int thr_id) {

    int i, j;

    for (i = j = 0; i < 10; i++, j++) {

        printf("this is thread #%d [%d]...\n", thr_id, j);
        t_yield();
    }

    printf("Thread %d is done...\n", thr_id);
    t_terminate();
}

// "double" thread: generates two single threads, keeps running
void double_thread(int thr_id) {

    // make two single threads
    int k;
    for (k = thr_id + 1; k < thr_id + 3; k++) {
        t_create(single_thread, k, 1);
        printf("this is double thread #%d, created single thread #%d.\n", thr_id, k);

    }
    t_yield();
    int i, j;

    for (i = j = 0; i < 8; i++, j++) {

        printf("this is 'double' thread %d [%d]...\n", thr_id, j);
        t_yield();
    }

    printf("Thread %d is done...\n", thr_id);
    t_terminate();
}

// "triple" thread: generates three "double" threads (each of which generates
// two single threads), keeps running
void triple_thread(int thr_id) {
    // make three double threads
    // these three new threads will be set to high priority
    int k;
    for (k = thr_id + 1; k < thr_id + 8; k += 3) {
        t_create(double_thread, k, 0);
        printf("this is triple thread #%d, created double thread #%d.\n", thr_id, k);
    }
    t_yield();
    int i, j;

    for (i = j = 0; i < 6; i++, j++) {

        printf("this is 'triple' thread %d [%d]...\n", thr_id, j);
        t_yield();
    }

    printf("Thread %d is done...\n", thr_id);
    t_terminate();
}

// "quad" thread: generates four single threads, keeps running (for shortest time)
void quad_thread(int thr_id) {
    // make four single threads
    int k;
    for (k = thr_id + 1; k < thr_id + 5; k++) {

        t_create(single_thread, k, 1);
        printf("this is quad thread #%d, created single thread #%d.\n", thr_id, k);

    }
    t_yield();
    int i, j;

    for (i = j = 0; i < 4; i++, j++) {

        printf("this is 'quad' thread #%d [%d]...\n", thr_id, j);
        t_yield();
    }

    printf("Thread %d is done...\n", thr_id);
    t_terminate();
}

int main(void) {

    int i;

    // thread library, main thread starts
    t_init();
    // start with creating single thread #1
    t_create(single_thread, 1, 1);
    printf("This is main()#0 created single thread[1]...\n");
    // now, create double thread #2 (will create two single threads #3 and #4)
    t_create(double_thread, 2, 1);
    printf("This is main()#0 created double thread[2]...\n");
    // now, create triple thread #5 (will create nine more threads #6 to #14)
    t_create(triple_thread, 5, 1);
    printf("This is main()#0 created triple thread[5]...\n");
    // finally, create quad thread #15 (will create four more threads #16 to #19)
    t_create(quad_thread, 15, 1);
    printf("This is main()#0 created quad thread[15]...\n");

    // go longer than all other threads (to show when t_yield is called with empty ready queue)
    for (i = 0; i < 16; i++) {

        printf("This is main()[%d]...\n", i);
        t_yield();
    }

    // all done
    printf("Begin shutdown...\n");
    t_shutdown();
    printf("Done with shutdown...\n");

    return 0;
}

/*
This is main()#0 created single thread[1]...
This is main()#0 created double thread[2]...
This is main()#0 created triple thread[5]...
This is main()#0 created quad thread[15]...
This is main()[0]...
this is thread #1 [0]...
this is double thread #2, created single thread #3.
this is double thread #2, created single thread #4.
this is triple thread #5, created double thread #6.
this is triple thread #5, created double thread #9.
this is triple thread #5, created double thread #12.
this is double thread #6, created single thread #7.
this is double thread #6, created single thread #8.
this is double thread #9, created single thread #10.
this is double thread #9, created single thread #11.
this is double thread #12, created single thread #13.
this is double thread #12, created single thread #14.
this is 'double' thread 6 [0]...
this is 'double' thread 9 [0]...
this is 'double' thread 12 [0]...
this is 'double' thread 6 [1]...
this is 'double' thread 9 [1]...
this is 'double' thread 12 [1]...
this is 'double' thread 6 [2]...
this is 'double' thread 9 [2]...
this is 'double' thread 12 [2]...
this is 'double' thread 6 [3]...
this is 'double' thread 9 [3]...
this is 'double' thread 12 [3]...
this is 'double' thread 6 [4]...
this is 'double' thread 9 [4]...
this is 'double' thread 12 [4]...
this is 'double' thread 6 [5]...
this is 'double' thread 9 [5]...
this is 'double' thread 12 [5]...
this is 'double' thread 6 [6]...
this is 'double' thread 9 [6]...
this is 'double' thread 12 [6]...
this is 'double' thread 6 [7]...
this is 'double' thread 9 [7]...
this is 'double' thread 12 [7]...
Thread 6 is done...
Thread 9 is done...
Thread 12 is done...
this is quad thread #15, created single thread #16.
this is quad thread #15, created single thread #17.
this is quad thread #15, created single thread #18.
this is quad thread #15, created single thread #19.
This is main()[1]...
this is thread #1 [1]...
this is thread #3 [0]...
this is thread #4 [0]...
this is 'double' thread 2 [0]...
this is 'triple' thread 5 [0]...
this is thread #7 [0]...
this is thread #8 [0]...
this is thread #10 [0]...
this is thread #11 [0]...
this is thread #13 [0]...
this is thread #14 [0]...
this is thread #16 [0]...
this is thread #17 [0]...
this is thread #18 [0]...
this is thread #19 [0]...
this is 'quad' thread #15 [0]...
This is main()[2]...
this is thread #1 [2]...
this is thread #3 [1]...
this is thread #4 [1]...
this is 'double' thread 2 [1]...
this is 'triple' thread 5 [1]...
this is thread #7 [1]...
this is thread #8 [1]...
this is thread #10 [1]...
this is thread #11 [1]...
this is thread #13 [1]...
this is thread #14 [1]...
this is thread #16 [1]...
this is thread #17 [1]...
this is thread #18 [1]...
this is thread #19 [1]...
this is 'quad' thread #15 [1]...
This is main()[3]...
this is thread #1 [3]...
this is thread #3 [2]...
this is thread #4 [2]...
this is 'double' thread 2 [2]...
this is 'triple' thread 5 [2]...
this is thread #7 [2]...
this is thread #8 [2]...
this is thread #10 [2]...
this is thread #11 [2]...
this is thread #13 [2]...
this is thread #14 [2]...
this is thread #16 [2]...
this is thread #17 [2]...
this is thread #18 [2]...
this is thread #19 [2]...
this is 'quad' thread #15 [2]...
This is main()[4]...
this is thread #1 [4]...
this is thread #3 [3]...
this is thread #4 [3]...
this is 'double' thread 2 [3]...
this is 'triple' thread 5 [3]...
this is thread #7 [3]...
this is thread #8 [3]...
this is thread #10 [3]...
this is thread #11 [3]...
this is thread #13 [3]...
this is thread #14 [3]...
this is thread #16 [3]...
this is thread #17 [3]...
this is thread #18 [3]...
this is thread #19 [3]...
this is 'quad' thread #15 [3]...
This is main()[5]...
this is thread #1 [5]...
this is thread #3 [4]...
this is thread #4 [4]...
this is 'double' thread 2 [4]...
this is 'triple' thread 5 [4]...
this is thread #7 [4]...
this is thread #8 [4]...
this is thread #10 [4]...
this is thread #11 [4]...
this is thread #13 [4]...
this is thread #14 [4]...
this is thread #16 [4]...
this is thread #17 [4]...
this is thread #18 [4]...
this is thread #19 [4]...
Thread 15 is done...
This is main()[6]...
this is thread #1 [6]...
this is thread #3 [5]...
this is thread #4 [5]...
this is 'double' thread 2 [5]...
this is 'triple' thread 5 [5]...
this is thread #7 [5]...
this is thread #8 [5]...
this is thread #10 [5]...
this is thread #11 [5]...
this is thread #13 [5]...
this is thread #14 [5]...
this is thread #16 [5]...
this is thread #17 [5]...
this is thread #18 [5]...
this is thread #19 [5]...
This is main()[7]...
this is thread #1 [7]...
this is thread #3 [6]...
this is thread #4 [6]...
this is 'double' thread 2 [6]...
Thread 5 is done...
this is thread #7 [6]...
this is thread #8 [6]...
this is thread #10 [6]...
this is thread #11 [6]...
this is thread #13 [6]...
this is thread #14 [6]...
this is thread #16 [6]...
this is thread #17 [6]...
this is thread #18 [6]...
this is thread #19 [6]...
This is main()[8]...
this is thread #1 [8]...
this is thread #3 [7]...
this is thread #4 [7]...
this is 'double' thread 2 [7]...
this is thread #7 [7]...
this is thread #8 [7]...
this is thread #10 [7]...
this is thread #11 [7]...
this is thread #13 [7]...
this is thread #14 [7]...
this is thread #16 [7]...
this is thread #17 [7]...
this is thread #18 [7]...
this is thread #19 [7]...
This is main()[9]...
this is thread #1 [9]...
this is thread #3 [8]...
this is thread #4 [8]...
Thread 2 is done...
this is thread #7 [8]...
this is thread #8 [8]...
this is thread #10 [8]...
this is thread #11 [8]...
this is thread #13 [8]...
this is thread #14 [8]...
this is thread #16 [8]...
this is thread #17 [8]...
this is thread #18 [8]...
this is thread #19 [8]...
This is main()[10]...
Thread 1 is done...
this is thread #3 [9]...
this is thread #4 [9]...
this is thread #7 [9]...
this is thread #8 [9]...
this is thread #10 [9]...
this is thread #11 [9]...
this is thread #13 [9]...
this is thread #14 [9]...
this is thread #16 [9]...
this is thread #17 [9]...
this is thread #18 [9]...
this is thread #19 [9]...
This is main()[11]...
Thread 3 is done...
Thread 4 is done...
Thread 7 is done...
Thread 8 is done...
Thread 10 is done...
Thread 11 is done...
Thread 13 is done...
Thread 14 is done...
Thread 16 is done...
Thread 17 is done...
Thread 18 is done...
Thread 19 is done...
This is main()[12]...
This is main()[13]...
This is main()[14]...
This is main()[15]...
Begin shutdown...
Done with shutdown...
 */